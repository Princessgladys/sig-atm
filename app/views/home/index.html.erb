<script type="text/javascript">
  //global variable
    var map = null;
    var infoWindow = new google.maps.InfoWindow;
    var center = new google.maps.LatLng(-8.67829132, 115.21475983);
  //end

  //initialize
    function initialize() {
      map = new google.maps.Map(document.getElementById("mapsGoogle"), {
        center              : center,
        zoom                : 13,
        disableDefaultUI    : true,
        mapTypeId           : 'roadmap',
      });

      //tampilkan marker ATM
        var urlnya = "home.json?bank_id=" + $("#home_bank_id").val()
        $.getJSON(urlnya, function(data) {
          for(var i=0; i<data.length; i++){
            var point = new google.maps.LatLng(parseFloat(data[i].lat),parseFloat(data[i].lng));
            var nama_atm = data[i].nama_atm;
            var nama_bank = data[i].nama_bank;
            var nama_lokasi = data[i].nama_lokasi;
            var kategori_atm = data[i].nama_kategori;
            var min_transaksi = data[i].nominal;
            // var id = data[i].id;
            var icon = data[i].icon;
            var html =  "<b>"+ nama_atm +"</b>"+
                        "<br/>Bank: <b>"+ nama_bank +"</b>"+
                        "<br/>Lokasi: <b>"+ nama_lokasi +"</b>"+
                        "<br/>Kategori: <b>"+ kategori_atm +"</b>"+
                        "<br/>Min Transaksi: <b>"+ min_transaksi +"</b>"+
                        "<hr size='1'>";

            var marker = new google.maps.Marker({
              map: map,
              position: point,
              // icon: "assets/atbank.png"
              icon: "assets/"+icon
            });
            
            InfoWindow(marker, map, infoWindow, html);
          };
        });

        //tampilkan infowindow setiap marker
          function InfoWindow(marker, map, infoWindow, html) {
            google.maps.event.addListener(marker, 'click', function() {
              infoWindow.setContent(html);
              infoWindow.open(map, marker);
              // map.setZoom(15);
              map.setCenter(marker.getPosition());
            });

            google.maps.event.addListener(map, 'click', function() {
              infoWindow.close();
            });
          };
        //end
      //end
    };
  //end

  $(document).ready(function(){
    $("#home_bank_id").on("change", function(){
      initialize();
    });
  });

  google.maps.event.addDomListener(window, 'load', initialize);
</script>

<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container-fluid">
      <div class="brand">Find ATMs</div>
      <ul class="nav pull-right">
        <li class="active"><%= link_to "Home", home_path %></li>
        <li><%= link_to "Admin", admin_path %></li>
        <li><%= link_to "Anggara Putra", "#" %></li>
      </ul>
    </div>
  </div>
</div>

<div class="row-fluid">
  <div id="mapsGoogle" class="well" style="height:440px;"></div>
</div>

<div class="row-fluid">
  <div class="well">
    <%= select("home", "bank_id", Bank.all.collect{ |x| [x.nama_bank, x.id] }, {}, { data: { :url => home_path }, class: "span3" }) %>
  </div>
</div>